<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consultar Hojas de Vida</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    .alert {
        border-radius: 0.75rem;
        border: none;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    .alert-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border-left: 4px solid #28a745;
    }
    .alert-danger {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border-left: 4px solid #dc3545;
    }
    .table-hover tbody tr:hover {
        background-color: rgba(13, 110, 253, 0.1) !important;
    }
  </style>
</head>
<body class="bg-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">
        <i class="bi bi-file-earmark-person-fill me-2"></i>Gestor de Hojas de Vida
      </a>
      <div class="navbar-nav ms-auto">
        <a href="/" class="btn btn-outline-light btn-sm me-2">
          <i class="bi bi-house"></i> Inicio
        </a>
        <a href="/registrarhojavida" class="btn btn-light btn-sm">
          <i class="bi bi-plus-circle"></i> Nueva
        </a>
      </div>
    </div>
  </nav>

  <!-- MENSAJES DE FEEDBACK -->
  <div class="container mt-3">
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  </div>

  <!-- HERO SECTION -->
  <section class="bg-primary text-white py-3 mb-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2 class="fw-bold mb-0">
            <i class="bi bi-list-ul me-2"></i>Consultar Hojas de Vida
          </h2>
        </div>
        <div class="col-md-4 text-md-end">
          <a href="/registrarhojavida" class="btn btn-light btn-sm">
            <i class="bi bi-plus-circle"></i> Agregar Nueva
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTENIDO -->
  <div class="container py-2">
    <!-- BUSCADOR -->
    <div class="row mb-4">
      <div class="col-md-6 offset-md-3">
        <div class="input-group shadow-sm">
          <span class="input-group-text bg-primary text-white">
            <i class="bi bi-search"></i>
          </span>
          <input type="text" id="buscador" class="form-control" placeholder="Buscar por nombre, correo, número o estudios...">
          <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
            <i class="bi bi-x-circle"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- TABLA -->
    <div class="card shadow-sm border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0" id="tablaHojas">
            <thead class="table-primary">
              <tr>
                <th class="ps-4"><i class="bi bi-person"></i> Nombre</th>
                <th><i class="bi bi-envelope"></i> Correo</th>
                <th><i class="bi bi-telephone"></i> Número</th>
                <th><i class="bi bi-book"></i> Estudios</th>
                <th class="text-center pe-4"><i class="bi bi-gear"></i> Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="hoja : ${hojas}" class="position-relative">
                <td class="ps-4 fw-medium" th:text="${hoja.nombre}"></td>
                <td th:text="${hoja.email}"></td>
                <td th:text="${hoja.numero}"></td>
                <td>
                  <span class="d-inline-block text-truncate" style="max-width: 150px;" th:text="${hoja.estudios}"></span>
                </td>
                <td class="text-center pe-4">
                  <div class="btn-group" role="group">
                    <!-- Ver PDF -->
                    <a th:href="@{/hojasvida/pdf/{numero}(numero=${hoja.numero}, ver=true)}" 
                       class="btn btn-sm btn-info" target="_blank" title="Ver PDF">
                      <i class="bi bi-eye"></i>
                    </a>
                    
                    <!-- Descargar PDF -->
                    <a th:href="@{/hojasvida/pdf/{numero}(numero=${hoja.numero})}" 
                       class="btn btn-sm btn-success" title="Descargar PDF">
                      <i class="bi bi-download"></i>
                    </a>

                    <!-- EDITAR -->
                    <a th:href="@{/editar/{numero}(numero=${hoja.numero})}" 
                       class="btn btn-sm btn-warning" title="Editar">
                      <i class="bi bi-pencil"></i>
                    </a>

                    <!-- ELIMINAR -->
                    <button type="button" 
                            class="btn btn-sm btn-danger" 
                            title="Eliminar"
                            th:attr="onclick='confirmarEliminacion(\'' + ${hoja.numero} + '\', \'' + ${hoja.nombre} + '\')'">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              
              <!-- Mensaje si no hay registros -->
              <tr th:if="${#lists.isEmpty(hojas)}">
                <td colspan="5" class="text-center py-5 text-muted">
                  <i class="bi bi-inbox display-4 d-block mb-2"></i>
                  <h5>No hay hojas de vida registradas</h5>
                  <p class="mb-0">Comienza agregando tu primera hoja de vida</p>
                  <a href="/registrarhojavida" class="btn btn-primary mt-3">
                    <i class="bi bi-plus-circle"></i> Agregar Primera Hoja
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- BOTÓN VOLVER -->
    <div class="text-center mt-4">
      <a href="/" class="btn btn-outline-primary">
        <i class="bi bi-house me-2"></i> Volver al Inicio
      </a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- SCRIPTS -->
  <script>
    // Función para búsqueda
    document.getElementById("buscador").addEventListener("keyup", function () {
      let filtro = this.value.toLowerCase();
      let filas = document.querySelectorAll("#tablaHojas tbody tr");
      let resultados = 0;

      filas.forEach(fila => {
        let textoFila = fila.innerText.toLowerCase();
        if (textoFila.includes(filtro)) {
          fila.style.display = "";
          resultados++;
        } else {
          fila.style.display = "none";
        }
      });
    });

    function clearSearch() {
      document.getElementById("buscador").value = "";
      let filas = document.querySelectorAll("#tablaHojas tbody tr");
      filas.forEach(fila => fila.style.display = "");
    }

    // Función para confirmar eliminación
    function confirmarEliminacion(numero, nombre) {
      if (confirm(`¿Estás seguro de eliminar la hoja de vida de ${nombre}? Esta acción no se puede deshacer.`)) {
        window.location.href = `/eliminar/${numero}`;
      }
    }
  </script>

</body>
</html>