<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Hoja de Vida - Vista Previa</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4361ee;
            --secondary: #7209b7;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --gradient-secondary: linear-gradient(135deg, #7209b7 0%, #560bad 100%);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .navbar-glass {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .alert-custom {
            border-radius: var(--border-radius);
            border: none;
            box-shadow: var(--shadow);
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-left: 4px solid var(--success);
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-left: 4px solid var(--danger);
        }
        
        .hero-section {
            background: var(--gradient-primary);
            color: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        
        .preview-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary);
        }
        
        .input-group-text {
            background: var(--gradient-primary);
            color: white;
            border: none;
            min-width: 70px;
            justify-content: center;
        }
        
        .pdf-preview {
            border: 2px dashed #dee2e6;
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .pdf-preview:hover {
            border-color: var(--primary);
            background-color: #f8f9fa;
        }
        
        .pdf-preview.has-file {
            border-color: var(--success);
            background-color: #f0fff4;
        }
        
        /* ESTILOS PARA LA HOJA DE VIDA PROFESIONAL */
        .cv-template {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            min-height: 800px;
            padding: 0;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }
        
        .cv-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2rem;
        }
        
        .cv-name {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .cv-title {
            font-size: 1.2rem;
            opacity: 0.9;
            margin: 0.5rem 0;
        }
        
        .cv-contact {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .cv-contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .cv-section {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #eee;
        }
        
        .cv-section-title {
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border-left: 4px solid #3498db;
            padding-left: 1rem;
        }
        
        .cv-content {
            line-height: 1.6;
            color: #555;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.6s ease-out;
        }
        
        .is-invalid {
            border-color: var(--danger) !important;
        }
        
        .invalid-feedback {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .sticky-preview {
            position: sticky;
            top: 20px;
        }
    </style>
</head>
<body>

    <!-- NAVBAR GLASS MORPHISM -->
    <nav class="navbar navbar-expand-lg navbar-glass">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="/">
                <i class="fas fa-file-alt me-2"></i>CVManager Pro
            </a>
            <div class="navbar-nav ms-auto">
                <a href="/" class="btn btn-outline-primary btn-sm me-2">
                    <i class="fas fa-home"></i> Inicio
                </a>
                <a href="/hojasvida" class="btn btn-outline-primary btn-sm me-2">
                    <i class="fas fa-list"></i> Ver Hojas
                </a>
                <a href="/registrarhojavida" class="btn btn-primary btn-sm">
                    <i class="fas fa-plus"></i> Nueva
                </a>
            </div>
        </div>
    </nav>

  <div class="container py-4">
    <div class="row">
      <!-- FORMULARIO -->
      <div class="col-lg-5 mb-4">
        <div class="glass-card p-4 h-100 animate-fadeIn">
          <h4 class="text-primary mb-4">
            <i class="fas fa-pencil-alt me-2"></i>Información Personal
          </h4>

          <form action="/insertarhojavida" method="post" enctype="multipart/form-data" novalidate>
            
            <!-- Nombre -->
            <div class="mb-3">
              <label class="form-label">Nombre Completo *</label>
              <input type="text" name="nombre" class="form-control" required oninput="updateCVPreview()">
            </div>

            <!-- Título Profesional -->
            <div class="mb-3">
              <label class="form-label">Título Profesional *</label>
              <input type="text" name="titulo" class="form-control" required oninput="updateCVPreview()">
            </div>

            <!-- País y Ciudad -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">País *</label>
                <select id="country" name="country" class="form-select" required onchange="loadCitiesAndDial()">
                  <option value="">Seleccione un país</option>
                  <th:block th:each="pais : ${paises}">
                    <option th:value="${pais.country}" th:text="${pais.country}"></option>
                  </th:block>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Ciudad *</label>
                <select id="city" name="city" class="form-select" required>
                  <option value="">Seleccione una ciudad</option>
                </select>
              </div>
            </div>

            <!-- Teléfono y Email -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Teléfono *</label>
                <div class="input-group">
                  <span class="input-group-text" id="dialPrefix">+</span>
                  <input type="hidden" id="dialCode" name="dialCode">
                  <input type="text" name="numero" class="form-control" required oninput="updateCVPreview()">
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Email *</label>
                <input type="email" name="email" class="form-control" required oninput="updateCVPreview()">
              </div>
            </div>

            <!-- LinkedIn y Dirección -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">LinkedIn (Opcional)</label>
                <input type="url" name="linkedin" class="form-control" oninput="updateCVPreview()">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Dirección (Opcional)</label>
                <input type="text" name="direccion" class="form-control" oninput="updateCVPreview()">
              </div>
            </div>

            <!-- Resumen -->
            <div class="mb-3">
              <label class="form-label">Resumen Profesional *</label>
              <textarea name="descripcion" class="form-control" rows="3" required oninput="updateCVPreview()"></textarea>
            </div>

            <!-- Experiencia -->
            <div class="mb-3">
              <label class="form-label">Experiencia Laboral *</label>
              <textarea name="experiencia" class="form-control" rows="3" required oninput="updateCVPreview()"></textarea>
            </div>

            <!-- Estudios -->
            <div class="mb-3">
              <label class="form-label">Formación Académica *</label>
              <textarea name="estudios" class="form-control" rows="3" required oninput="updateCVPreview()"></textarea>
            </div>

            <!-- Habilidades -->
            <div class="mb-3">
              <label class="form-label">Habilidades *</label>
              <input type="text" name="habilidades" class="form-control" required oninput="updateCVPreview()">
            </div>

            <!-- PDF -->
            <div class="mb-3">
              <label class="form-label">Subir PDF (Opcional)</label>
              <input type="file" name="pdf" class="form-control" accept="application/pdf">
            </div>

            <!-- Botón -->
            <button type="submit" class="btn btn-primary w-100">Guardar Hoja de Vida</button>
          </form>
        </div>
      </div>

      <!-- VISTA PREVIA -->
      <div class="col-lg-7">
        <div class="sticky-preview">
          <div class="glass-card p-4 h-100 animate-fadeIn">
            <h4 class="text-secondary mb-4"><i class="fas fa-eye me-2"></i>Vista Previa</h4>
            <div class="cv-template">
              <div class="cv-header">
                <h1 id="cvNombre">Nombre Completo</h1>
                <div id="cvTitulo">Título Profesional</div>
                <div class="cv-contact">
                  <div><i class="fas fa-phone"></i> <span id="cvTelefono">+ 3001234567</span></div>
                  <div><i class="fas fa-envelope"></i> <span id="cvEmail">email@ejemplo.com</span></div>
                  <div><i class="fas fa-map-marker-alt"></i> <span id="cvUbicacion">País, Ciudad</span></div>
                </div>
              </div>
              <div class="cv-section">
                <h3>Resumen Profesional</h3>
                <div id="cvResumen">Aquí aparecerá tu resumen profesional...</div>
              </div>
              <div class="cv-section">
                <h3>Experiencia Laboral</h3>
                <div id="cvExperiencia">Aquí aparecerá tu experiencia laboral...</div>
              </div>
              <div class="cv-section">
                <h3>Formación Académica</h3>
                <div id="cvEducacion">Aquí aparecerá tu formación académica...</div>
              </div>
              <div class="cv-section">
                <h3>Habilidades</h3>
                <div id="cvHabilidades">Aquí aparecerán tus habilidades...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- SCRIPTS: funciones combinadas -->
  <script>
    async function loadCitiesAndDial() {
      const country = document.getElementById("country").value;
      if (!country) return;

      const responseCities = await fetch(`/formulario/ciudades?pais=${encodeURIComponent(country)}`);
      const cities = await responseCities.json();

      const citySelect = document.getElementById("city");
      citySelect.innerHTML = "<option value=''>Seleccione una ciudad</option>";
      cities.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        citySelect.appendChild(opt);
      });

      const responseDial = await fetch(`/formulario/dialcode?pais=${encodeURIComponent(country)}`);
      const dial = await responseDial.text();
      document.getElementById("dialPrefix").textContent = dial || "+";
      document.getElementById("dialCode").value = dial || "+";

      updateCVPreview();
    }

    function updateCVPreview() {
      const nombre = document.querySelector('input[name="nombre"]').value || 'Nombre Completo';
      const titulo = document.querySelector('input[name="titulo"]').value || 'Título Profesional';
      const country = document.querySelector('#country').value || 'País';
      const city = document.querySelector('#city').value || 'Ciudad';
      const dialCode = document.getElementById('dialCode').value || '+';
      const telefono = document.querySelector('input[name="numero"]').value ? dialCode + ' ' + document.querySelector('input[name="numero"]').value : '+ 3001234567';
      const email = document.querySelector('input[name="email"]').value || 'email@ejemplo.com';
      const descripcion = document.querySelector('textarea[name="descripcion"]').value || 'Aquí aparecerá tu resumen profesional...';
      const experiencia = document.querySelector('textarea[name="experiencia"]').value || 'Aquí aparecerá tu experiencia laboral...';
      const estudios = document.querySelector('textarea[name="estudios"]').value || 'Aquí aparecerá tu formación académica...';
      const habilidades = document.querySelector('input[name="habilidades"]').value || 'Aquí aparecerán tus habilidades...';

      document.getElementById('cvNombre').textContent = nombre;
      document.getElementById('cvTitulo').textContent = titulo;
      document.getElementById('cvTelefono').textContent = telefono;
      document.getElementById('cvEmail').textContent = email;
      document.getElementById('cvUbicacion').textContent = `${country}, ${city}`;
      document.getElementById('cvResumen').textContent = descripcion;
      document.getElementById('cvExperiencia').textContent = experiencia;
      document.getElementById('cvEducacion').textContent = estudios;
      document.getElementById('cvHabilidades').textContent = habilidades;
    }
  </script>
</body>
</html>
