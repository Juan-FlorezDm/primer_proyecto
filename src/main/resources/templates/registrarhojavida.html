<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${esEdicion != null and esEdicion} ? 'Editar Hoja de Vida' : 'Registrar Hoja de Vida'"></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    .alert {
        border-radius: 0.75rem;
        border: none;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    .alert-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border-left: 4px solid #28a745;
    }
    .alert-danger {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border-left: 4px solid #dc3545;
    }
    .form-section {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 1rem;
        border-left: 4px solid #0d6efd;
    }
    .preview-section {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 1rem;
        border-left: 4px solid #6c757d;
    }
  </style>
</head>
<body class="bg-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">
        <i class="bi bi-file-earmark-person-fill me-2"></i>Gestor de Hojas de Vida
      </a>
      <div class="navbar-nav ms-auto">
        <a href="/" class="btn btn-outline-light btn-sm me-2">
          <i class="bi bi-house"></i> Inicio
        </a>
        <a href="/hojasvida" class="btn btn-outline-light btn-sm">
          <i class="bi bi-list-ul"></i> Consultar
        </a>
      </div>
    </div>
  </nav>

  <!-- MENSAJES DE FEEDBACK -->
  <div class="container mt-3">
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  </div>

  <!-- HERO SECTION -->
  <section class="bg-primary text-white py-3 mb-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2 class="fw-bold mb-0">
            <i class="bi bi-plus-circle-fill me-2" th:if="${esEdicion == null or !esEdicion}"></i>
            <i class="bi bi-pencil-fill me-2" th:if="${esEdicion != null and esEdicion}"></i>
            <span th:text="${esEdicion != null and esEdicion} ? 'Editar Hoja de Vida' : 'Registrar Nueva Hoja de Vida'"></span>
          </h2>
        </div>
        <div class="col-md-4 text-md-end">
          <a href="/hojasvida" class="btn btn-light btn-sm">
            <i class="bi bi-arrow-left"></i> Volver al Listado
          </a>
        </div>
      </div>
    </div>
  </section>

  <div class="container py-2">
    <div class="row">
      <!-- FORMULARIO -->
      <div class="col-md-6">
        <div class="form-section card shadow-sm p-4 h-100">
          <h4 class="text-primary mb-4">
            <i class="bi bi-pencil-square me-2"></i>
            <span th:text="${esEdicion != null and esEdicion} ? 'Formulario de Edici√≥n' : 'Formulario de Registro'"></span>
          </h4>

          <form th:action="${esEdicion != null and esEdicion} ? @{'/actualizar/{numero}'(numero=hojaVida.numero)} : @{/insertarhojavida}" 
                th:object="${hojaVida}" 
                method="post" 
                enctype="multipart/form-data">

            <div class="mb-3">
              <label class="form-label fw-bold">Nombre Completo *</label>
              <input type="text" th:field="*{nombre}" id="nombre" class="form-control" placeholder="Ej: Mar√≠a Garc√≠a L√≥pez" oninput="updatePreview()">
              <div class="text-danger" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
            </div>


<div class="mb-3">
  <label class="form-label fw-bold">Pa√≠s *</label>
  <select id="country" name="country" class="form-select" onchange="loadCitiesAndDial()">
    <option value="">Seleccione un pa√≠s</option>
    <option th:each="p : ${paises}"
            th:value="${p.country}"
            th:text="${p.country}">
    </option>
  </select>
</div>

<div class="mb-3">
  <label class="form-label fw-bold">Ciudad *</label>
  <select id="city" name="city" class="form-select">
    <option value="">Seleccione una ciudad</option>
  </select>
</div>

      <div class="mb-3">
        <label class="form-label fw-bold">N√∫mero de Tel√©fono *</label>
        <div class="input-group">
          <span class="input-group-text" id="dialPrefix">+</span>
          <input type="hidden" id="dialCode" name="dialCode"> <!-- üëà dial oculto -->
          <input type="text" th:field="*{numero}" id="numero" class="form-control"
                placeholder="3001234567">
        </div>
      </div>


            <div class="mb-3">
              <label class="form-label fw-bold">Correo Electr√≥nico *</label>
              <input type="email" th:field="*{email}" id="email" class="form-control" placeholder="ejemplo@correo.com" oninput="updatePreview()">
              <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Descripci√≥n Profesional *</label>
              <textarea th:field="*{descripcion}" id="descripcion" class="form-control" rows="3" placeholder="Describa su experiencia y habilidades..." oninput="updatePreview()"></textarea>
              <div class="text-danger" th:if="${#fields.hasErrors('descripcion')}" th:errors="*{descripcion}"></div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Estudios y Formaci√≥n *</label>
              <textarea th:field="*{estudios}" id="estudios" class="form-control" rows="2" placeholder="T√≠tulos, certificaciones, cursos..." oninput="updatePreview()"></textarea>
              <div class="text-danger" th:if="${#fields.hasErrors('estudios')}" th:errors="*{estudios}"></div>
            </div>
            


            <div class="mb-4">
              <label class="form-label fw-bold">
                <span th:if="${esEdicion != null and esEdicion}">Actualizar PDF</span>
                <span th:if="${esEdicion == null or !esEdicion}">Subir PDF de Hoja de Vida</span>
                <span th:if="${esEdicion == null or !esEdicion}">*</span>
              </label>
              <input type="file" name="pdf" class="form-control" accept="application/pdf" 
                     th:required="${esEdicion != null ? !esEdicion : true}">
              <small class="text-muted" th:if="${esEdicion != null and esEdicion}">
                Opcional: Selecciona un nuevo archivo solo si deseas reemplazar el actual
              </small>
              <small class="text-muted" th:if="${esEdicion == null or !esEdicion}">
                Solo se permiten archivos en formato PDF
              </small>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-success btn-lg">
                <i class="bi bi-check-circle-fill me-2"></i>
                <span th:if="${esEdicion != null and esEdicion}">Actualizar Hoja de Vida</span>
                <span th:if="${esEdicion == null or !esEdicion}">Guardar Hoja de Vida</span>
              </button>
              
              <a href="/hojasvida" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i> Volver al Listado
              </a>
            </div>
          </form>
        </div>
      </div>

      <!-- VISTA PREVIA -->
      <div class="col-md-6">
        <div class="preview-section card shadow-sm p-4 h-100">
          <h4 class="text-secondary mb-4">
            <i class="bi bi-eye-fill me-2"></i>Vista Previa
          </h4>
          
          <div class="mb-3">
            <strong>Nombre:</strong>
            <div class="text-primary" id="previewNombre" th:text="${hojaVida.nombre} ?: '‚Äî'"></div>
          </div>
          
          <div class="mb-3">
            <strong>N√∫mero:</strong>
            <div class="text-primary" id="previewNumero" th:text="${hojaVida.numero} ?: '‚Äî'"></div>
          </div>
          
          <div class="mb-3">
            <strong>Email:</strong>
            <div class="text-primary" id="previewEmail" th:text="${hojaVida.email} ?: '‚Äî'"></div>
          </div>
          
          <div class="mb-3">
            <strong>Descripci√≥n:</strong>
            <div class="text-muted" id="previewDescripcion" th:text="${hojaVida.descripcion} ?: '‚Äî'"></div>
          </div>
          
          <div class="mb-3">
            <strong>Estudios:</strong>
            <div class="text-muted" id="previewEstudios" th:text="${hojaVida.estudios} ?: '‚Äî'"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- SCRIPT PREVIEW -->
  <script>

    
    function updatePreview() {
  document.getElementById("previewNombre").innerText = document.getElementById("nombre").value || "‚Äî";
  document.getElementById("previewNumero").innerText = document.getElementById("numero").value || "‚Äî";
  document.getElementById("previewEmail").innerText = document.getElementById("email").value || "‚Äî";
  document.getElementById("previewDescripcion").innerText = document.getElementById("descripcion").value || "‚Äî";
  document.getElementById("previewEstudios").innerText = document.getElementById("estudios").value || "‚Äî";
}


    // Inicializar vista previa con valores existentes
    document.addEventListener('DOMContentLoaded', function() {
      updatePreview();
    });


   async function loadCitiesAndDial() {
  const country = document.getElementById("country").value;
  if (!country) return;

  // cargar ciudades
  const responseCities = await fetch(`/formulario/cuidades?pais=${country}`);
  const cities = await responseCities.json();

  const citySelect = document.getElementById("city");
  citySelect.innerHTML = "<option value=''>Seleccione una ciudad</option>";

  cities.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    citySelect.appendChild(opt);
  });

  // cargar dial
const responseDial = await fetch(`/formulario/dialcode?pais=${country}`);
const dial = await responseDial.text();

// mostrar prefijo fijo en el span
document.getElementById("dialPrefix").textContent = dial || "+";

// guardar el dial en el input hidden
document.getElementById("dialCode").value = dial || "+";


  updatePreview();
}

    
  </script>

</body>
</html>